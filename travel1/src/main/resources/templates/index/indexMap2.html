<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="../js/jquery.min.js" type="text/javascript"></script>
    <script src="../js/echarts.min.js"></script>
    <script src="../js/china.js"></script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <link href="../media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/style-metro.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="../media/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/jquery.gritter.css" rel="stylesheet" type="text/css"/>

    <link href="../media/css/daterangepicker.css" rel="stylesheet" type="text/css" />
    <link href="../media/css/fullcalendar.css" rel="stylesheet" type="text/css"/>
    <link href="../media/css/jqvmap.css" rel="stylesheet" type="text/css" media="screen"/>

    <link href="../media/css/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css" media="screen"/>


    <script	src="../layer/layer.js" type="text/javascript">	</script>

    <link rel="shortcut icon" href="../media/image/favicon.ico" />

</head>
<div class="page-container">

    <!-- 左边菜单栏 下-->
    <div class="page-sidebar nav-collapse collapse" th:include="left.html">
    </div>
    <!-- 左边菜单栏 上-->

    <!--主体区 -->
    <div class="page-content">

        <!--主页-->
        <div class="container-fluid">
            <!--页头-->
            <div class="row-fluid">
                <div class="span12">
                    <h3 class="page-title">
                        <!--页头  仪表盘-->
                        首页 <small>statistics and more</small>
                    </h3>
                    <ul class="breadcrumb">
                        <!--当前页面的地址-->
                        <li>
                            <i class="icon-home"></i>
                            <a href="index.html">首页</a>
                            <i class="icon-angle-right"></i>
                        </li>
                        <li><a href="#">Dashboard</a></li>
                    </ul>
                </div>
            </div>
            <!-- 页头结束-->

            <div id="dashboard">
                <!-- 整个页面 -->
                <!-- 第一个大分区，里边四个小分区 -->
                <div class="row-fluid">

                    <div class="span9">
                        <!-- BEGIN PORTLET-->
                        <div class="portlet solid bordered light-grey">
                            <div class="portlet-title">
                                <div class="caption"><i class="icon-bar-chart"></i>全国旅游心情图</div>
                                <div class="tools">
                                    <div class="btn-group pull-right" data-toggle="buttons-radio">
                                        <!--<a href="" class="btn mini">Users</a>
                                        <a href="" class="btn mini active">Feedbacks</a>-->
                                        <select name="month" id="month" >
                                            <option value="1" onclick="changeMonth()">3-5月</option>
                                            <option value="2" onclick="changeMonth()">6-8月</option>
                                            <option value="3" onclick="changeMonth()">9-11月</option>
                                            <option value="4" onclick="changeMonth()">12-2月</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="portlet-body">
                                <!--加载地图 class="span9"-->
                                <div id="main"  style="width:100%;height:500px;background-color: #f5f6f0"></div>
                            </div>
                        </div>
                        <!-- END PORTLET-->
                    </div>

                    <!--<div class="span9">
                        <div id="main" class="span12" style="height:800px;background-color: #d2d4dd"></div>
                    </div>-->

                    <div class="span3">
                        <!-- BEGIN PORTLET-->
                        <div class="portlet paddingless">
                            <div class="portlet-title line">
                                <div class="caption"><i class="icon-bell"></i>热门排行</div>
                                <div class="tools">
                                    <a href="" class="collapse"></a>
                                    <a href="#portlet-config" data-toggle="modal" class="config"></a>
                                    <a href="" class="reload"></a>

                                </div>
                            </div>
                            <div class="portlet-body">
                                <!--BEGIN TABS-->
                                <div class="tabbable tabbable-custom">
                                    <ul class="nav nav-tabs">
                                        <li class="active"><a href="#tab_1_1" data-toggle="tab">当季最热城市</a></li>
                                        <li><a href="#tab_1_2" data-toggle="tab">热门景点</a></li>
                                        <!--<li><a href="#tab_1_3" data-toggle="tab">Recent Users</a></li>-->
                                    </ul>
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="tab_1_1">
                                            <div class="scroller" data-height="290px" data-always-visible="1" data-rail-visible="0">
                                                <ul class="feeds">
                                                    <li>
                                                        <div class="col1">
                                                            <div class="cont">
                                                                <div class="cont-col1">
                                                                    <div class="label label-success">
                                                                        <i class="icon-bell"></i>
                                                                    </div>
                                                                </div>
                                                                <div class="cont-col2">
                                                                    <div class="desc">
                                                                        杭州
                                                                        <!--<span class="label label-important label-mini">
                                                                        Take action
                                                                        <i class="icon-share-alt"></i>
                                                                        </span>-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col2">
                                                            <div class="date">
                                                                Just now
                                                            </div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="col1">
                                                            <div class="cont">
                                                                <div class="cont-col1">
                                                                    <div class="label label-success">
                                                                        <i class="icon-bell"></i>
                                                                    </div>
                                                                </div>
                                                                <div class="cont-col2">

                                                                    <div class="desc">
                                                                        北京
                                                                        <!--<span class="label label-important label-mini">
                                                                        Take action
                                                                        <i class="icon-share-alt"></i>
                                                                        </span>-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col2">
                                                            <div class="date">
                                                                Just now
                                                            </div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="col1">
                                                            <div class="cont">
                                                                <div class="cont-col1">
                                                                    <div class="label label-success">
                                                                        <i class="icon-bell"></i>
                                                                    </div>
                                                                </div>
                                                                <div class="cont-col2">
                                                                    <div class="desc">
                                                                        成都
                                                                        <!--<span class="label label-important label-mini">
                                                                        Take action
                                                                        <i class="icon-share-alt"></i>
                                                                        </span>-->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col2">
                                                            <div class="date">
                                                                Just now
                                                            </div>
                                                        </div>
                                                    </li>


                                                </ul>
                                            </div>
                                        </div>

                                        <div class="tab-pane" id="tab_1_2">
                                            <div class="scroller" data-height="290px" data-always-visible="1" data-rail-visible1="1">
                                                <ul class="feeds">
                                                    <li>
                                                        <a href="#">
                                                            <div class="col1">
                                                                <div class="cont">
                                                                    <div class="cont-col1">
                                                                        <div class="label label-success">
                                                                            <i class="icon-bell"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div class="cont-col2">
                                                                        <div class="desc">
                                                                            西湖
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col2">
                                                                <div class="date">
                                                                    Jst now
                                                                </div>
                                                            </div>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="#">
                                                            <div class="col1">
                                                                <div class="cont">
                                                                    <div class="cont-col1">
                                                                        <div class="label label-success">
                                                                            <i class="icon-bell"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div class="cont-col2">
                                                                        <div class="desc">
                                                                            千岛湖
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col2">
                                                                <div class="date">
                                                                    Jst now
                                                                </div>
                                                            </div>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="#">
                                                            <div class="col1">
                                                                <div class="cont">
                                                                    <div class="cont-col1">
                                                                        <div class="label label-success">
                                                                            <i class="icon-bell"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div class="cont-col2">
                                                                        <div class="desc">
                                                                            故宫
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col2">
                                                                <div class="date">
                                                                    Jst now
                                                                </div>
                                                            </div>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="#">
                                                            <div class="col1">
                                                                <div class="cont">
                                                                    <div class="cont-col1">
                                                                        <div class="label label-success">
                                                                            <i class="icon-bell"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div class="cont-col2">
                                                                        <div class="desc">
                                                                            九寨沟
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="col2">
                                                                <div class="date">
                                                                    Jst now
                                                                </div>
                                                            </div>
                                                        </a>
                                                    </li>

                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--二 -->
                    <!--<div class="span12">-->

                    <div class="clearfix"></div>
                </div>
            </div>
        </div>

        <!-- 页 -->
    </div>

    <div class="footer">
        <div class="footer-tools">
			<span class="go-top">
			<i class="icon-angle-up"><font size="3">回到顶部</font></i>
			</span>
        </div>
    </div>
</div>


<!-- 底部 -->

<!-- JS -->
<script src="../media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<script src="../media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
<script src="../media/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../media/js/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="../media/js/jquery.blockui.min.js" type="text/javascript"></script>
<script src="../media/js/jquery.cookie.min.js" type="text/javascript"></script>
<script src="../media/js/jquery.uniform.min.js" type="text/javascript" ></script>
<script src="../media/js/jquery.vmap.js" type="text/javascript"></script>
<script src="../media/js/jquery.vmap.russia.js" type="text/javascript"></script>
<script src="../media/js/jquery.vmap.world.js" type="text/javascript"></script>
<script src="../media/js/jquery.vmap.europe.js" type="text/javascript"></script>
<script src="../media/js/jquery.vmap.germany.js" type="text/javascript"></script>
<script src="../media/js/jquery.vmap.usa.js" type="text/javascript"></script>
<script src="../media/js/jquery.vmap.sampledata.js" type="text/javascript"></script>
<script src="../media/js/jquery.flot.js" type="text/javascript"></script>
<script src="../media/js/jquery.flot.resize.js" type="text/javascript"></script>
<script src="../media/js/jquery.pulsate.min.js" type="text/javascript"></script>
<script src="../media/js/date.js" type="text/javascript"></script>
<script src="../media/js/daterangepicker.js" type="text/javascript"></script>
<script src="../media/js/jquery.gritter.js" type="text/javascript"></script>
<script src="../media/js/fullcalendar.min.js" type="text/javascript"></script>
<script src="../media/js/jquery.easy-pie-chart.js" type="text/javascript"></script>
<script src="../media/js/jquery.sparkline.min.js" type="text/javascript"></script>
<script src="../media/js/app.js" type="text/javascript"></script>
<script src="../media/js/index.js" type="text/javascript"></script>

<!-- END PAGE LEVEL SCRIPTS -->

<script>
    jQuery(document).ready(function() {
        App.init(); // initlayout and core plugins
        Index.init();
        Index.initChat();
        Index.initMiniCharts();
        Index.initDashboardDaterange();
    });
</script>



</body>


<script>
    var myChart = echarts.init(document.getElementById('main'));

    // var province = ['北京', '天津', '河北', '山西', '内蒙古', '辽宁', '吉林', '黑龙江', '上海', '江苏', '浙江', '安徽', '福建', '江西', '山东', '河南', '湖北', '湖南', '广东', '广西', '海南', '重庆', '四川', '贵州', '云南', '西藏', '陕西', '甘肃', '青海', '宁夏', '新疆'];
    /*
    $.ajax({
        type : "get",
        data:{"month":month},
        url : "/monthJingdianNum", //此次url改为真正需要的url
        success : function(data, status) {
            /*
            $.each(data, function(index, item) {
                $("#select").append(  //此处向select中循环绑定数据
                    "<option value="+item.id+">" + item.name+ "</option>");
            });*//*

        },
    });
    */
    $.ajax({
        type : "get",
        url : "/monthJingdianNum", //此次url改为真正需要的url
        success : function(data, status) {
            /*
            $.each(data, function(index, item) {
                $("#select").append(  //此处向select中循环绑定数据
                    "<option value="+item.id+">" + item.name+ "</option>");
            });*/

        },
    });

    //各省份的地图json文件
    var provinces = {
        '上海': '../datajson/data-1482909900836-H1BC_1WHg.json',
        '河北': '../datajson/data-1482909799572-Hkgu_yWSg.json',
        '山西': '../datajson/data-1482909909703-SyCA_JbSg.json',
        '内蒙古': '../datajson/data-1482909841923-rkqqdyZSe.json',
        '辽宁': '../datajson/data-1482909836074-rJV9O1-Hg.json',
        '吉林': '../datajson/data-1482909832739-rJ-cdy-Hx.json',
        '黑龙江': '../datajson/data-1482909803892-Hy4__J-Sx.json',
        '江苏': '../datajson/data-1482909823260-HkDtOJZBx.json',
        '浙江': '../datajson/data-1482909960637-rkZMYkZBx.json',
        '安徽': '../datajson/data-1482909768458-HJlU_yWBe.json',
        '福建': '../datajson/data-1478782908884-B1H6yezWe.json',
        '江西': '../datajson/data-1482909827542-r12YOJWHe.json',
        '山东': '../datajson/data-1482909892121-BJ3auk-Se.json',
        '河南': '../datajson/data-1482909807135-SJPudkWre.json',
        '湖北': '../datajson/data-1482909813213-Hy6u_kbrl.json',
        '湖南': '../datajson/data-1482909818685-H17FOkZSl.json',
        '广东': '../datajson/data-1482909784051-BJgwuy-Sl.json',
        '广西': '../datajson/data-1482909787648-SyEPuJbSg.json',
        '海南': '../datajson/data-1482909796480-H12P_J-Bg.json',
        '四川': '../datajson/data-1482909931094-H17eKk-rg.json',
        '贵州': '../datajson/data-1482909791334-Bkwvd1bBe.json',
        '云南': '../datajson/data-1482909957601-HkA-FyWSx.json',
        '西藏': '../datajson/data-1482927407942-SkOV6Qbrl.json',
        '陕西': '../datajson/data-1482909918961-BJw1FyZHg.json',
        '甘肃': '../datajson/data-1482909780863-r1aIdyWHl.json',
        '青海': '../datajson/data-1482909853618-B1IiOyZSl.json',
        '宁夏': '../datajson/data-1482909848690-HJWiuy-Bg.json',
        '新疆': '../datajson/data-1482909952731-B1YZKkbBx.json',
        '北京': '../datajson/data-1482818963027-Hko9SKJrg.json',
        '天津': '../datajson/data-1482909944620-r1-WKyWHg.json',
        '重庆': '../datajson/data-1482909775470-HJDIdk-Se.json',
        '香港': '../datajson/data-1461584707906-r1hSmtsx.json',
        '澳门': '../datajson/data-1482909771696-ByVIdJWBx.json'
    };

    //各省份的数据
    var allData = [
        {name: '北京'},
        {name: '天津'},
        {name: '上海'},
        {name: '重庆'},
        {name: '河北'},
        {name: '河南'},
        {name: '云南'},
        {name: '辽宁'},
        {name: '黑龙江'},
        {name: '湖南'},
        {name: '安徽'},
        {name: '山东'},
        {name: '新疆'},
        {name: '江苏'},
        {name: '浙江'},
        {name: '江西'},
        {name: '湖北'},
        {name: '广西'},
        {name: '甘肃'},
        {name: '山西'},
        {name: '内蒙古'},
        {name: '陕西'},
        {name: '吉林'},
        {name: '福建'},
        {name: '贵州'},
        {name: '广东'},
        {name: '青海'},
        {name: '西藏'},
        {name: '四川'},
        {name: '宁夏'},
        {name: '海南'},
        {name: '台湾'},
        {name: '香港'},
        {name: '澳门'}];
    //地图中的地点 经纬度和名称
    var geoCoordMap = { //为了保证饼图不互相重叠，我对经纬坐标进行了调整
        '上海':  [121.472644,  31.231706],
        '云南':  [102.712251,  24.040609],
        '内蒙古':  [111.670801,  40.818311],
        '北京':  [116.405285,  39.904989],
        '台湾': [121.509062, 25.044332],
        '吉林':  [125.3245,  43.886841],
        '四川':  [103.065735,  30.659462],
        '天津':  [119.190182,  39.125596],
        '宁夏':  [106.278179,  38.46637],
        '安徽':  [117.283042,  31.86119],
        '山东':  [118.000923,  36.675807],
        '山西':  [112.049248,  37.057014],
        '广东':  [113.280637,  23.125178],
        '广西':  [108.320004,  22.82402],
        '新疆':  [87.617733,  43.792818],
        '江苏':  [119.467413,  33.741544],
        '江西':  [115.892151,  28.676493],
        '河北':  [114.802461,  37.745474],
        '河南':  [113.665412,  33.757975],
        '浙江':  [120.153576,  29.287459],
        '海南':  [110.33119,  20.031971],
        '湖北':  [113.298572,  30.984355],
        '湖南':  [112.12279,  28.19409],
        // '澳门': [113.54909, 22.198951],
        '甘肃':  [103.823557,  36.058039],
        '福建':  [119.306239,  26.075302],
        '西藏':  [91.132212,  29.660361],
        '贵州':  [106.713478,  26.578343],
        '辽宁':  [123.029096,  41.396767],
        '重庆':  [106.504962,  29.933155],
        '陕西':  [108.948024,  34.263161],
        '青海':  [100.578916,  36.623178],
        // '香港': [114.173355, 22.320048],
        '黑龙江':  [126.642464,  46.756967],
    }

    var typeArr = ["男性", "女性", "城镇人口", "农村人口"];
    var typeIndex = 1;
    var nametext = "定制地图区域饼图数据统计";

    //给每个省赋值
    for (var i = 0; i < allData.length; i++) {
        allData[i].value = Math.round(Math.random() * 100);
    }

    //初始化全国地图
    loadMap('../datajson/data-1527045631990-r1dZ0IM1X.json', 'china');
    var timeFn = null;

    //单击切换到省级地图，当mapCode有值,说明可以切换到下级地图
    myChart.on('click', function(params) {
        console.log("点击事件参数：")
        clearTimeout(timeFn);
        //由于单击事件和双击事件冲突，故单击的响应事件延迟250毫秒执行
        timeFn = setTimeout(function() {
            var name = params.name; //地区name
            console.log("点击事件参数："+name)
            var mapCode = provinces[name]; //地区的json数据
            console.log("根据参数，获得mapCode："+mapCode)
            if (!mapCode) {
                alert('无此区域地图显示');
                return;
            }
            //如果获得mapCode,加载地图
            loadMap(mapCode, name);
        }, 250);
    });
    // 绑定双击事件，返回全国地图
    myChart.on('dblclick', function(params) {
        //当双击事件发生时，清除单击事件，仅响应双击事件
        clearTimeout(timeFn);
        //返回全国地图
        loadMap('../datajson/data-1527045631990-r1dZ0IM1X.json', 'china');
    });

    //变换地图数据（格式）：pie 总数
    /*
    function convertMapDta(type, data) {
        var mapData = [];
        data.forEach(function(v) {
            v.value.forEach(function(v1) {
                if (String(v1.name) === String(type)) {
                    // 数据格式：data: [120, 200, 150, 80]
                    mapData.push({
                        "name": v.name,
                        "value": v1.value
                    })
                }
            })
        });
        return mapData;
    }
    */

    /**
     获取对应的json地图数据，然后向echarts注册该区域的地图，最后加载地图信息
     @params {String} mapCode:json数据的地址
     @params {String} name: 地图名称
     */
    function loadMap(mapCode, name) {
        if(name == 'china'){
            var data = [];
            console.log("全国")
            var mapdata1 = [];
            $.get(mapCode, function(geoJson) {
                var option = null;
                echarts.registerMap(name, geoJson);
                var mapFeatures = echarts.getMap(name).geoJson.features;
                mapFeatures.forEach(function(v) {  //给该地图的每个小级别赋值  例：省

                    // 地区名称 对应的经纬度赋值
                    var name = v.properties.name;
                    // 地区经纬度
                    // geoCoordMap[name] = v.properties.cp;

                    //通过ajax,查询该省的游记总个数，好的游记个数、差的游记个数、一般的游记个数
                    /*
                    $.ajax({
                        "url": "/getProvinceNum",
                        "data":{"province": name},
                        "async": false,
                        "type": "get",
                        "dataType": "json",
                        "success": function (data) {
                            //provinceBean的对象，取出其中的总数，好的总数、坏的总数、一般的总数
                            if (null != data && "" != data) {
                                //总量
                                mapdata1.push({
                                    name: name,
                                    value: s1 + s2
                                })

                                data.push({  //data的数量也是饼图的数量
                                    // 需要挨个处理各地区数据（不使用随机产生的数）：另外需要构造的数据是柱图数据
                                    "name": name,
                                    "value": [
                                        {name: "男性",value: s1,},
                                        {name: "女性",value: s2,},
                                    ]
                                })
                            }
                        }
                    });
                    */
                    //给饼图赋值
                    var s1 = Math.round(Math.random() * 100 + 10);
                    var s2 = Math.round(Math.random() * 100 + 10);
                    data.push({  //data的数量也是饼图的数量
                        // 需要挨个处理各地区数据（不使用随机产生的数）：另外需要构造的数据是柱图数据
                        "name": name,
                        "value": [
                            {name: "男性",value: s1,},
                            {name: "女性",value: s2,},
                        ]
                    })
                    //总量
                    mapdata1.push({
                        name: name,
                        value: s1 + s2
                    })
                    //console.log("数量："+mapdata1.value)
                });

                // var mapdata1=[{name:"冷水江市",value:data[0]},{},{},{},{},{}]
                /*addPie*/
                function addPie(chart, data) {
                    var op = chart.getOption();
                    var sd = option.series;
                    for (var i = 0; i < data.length; i++) {
                        var randomValue = 15;
                        var radius = randomValue;
                        var geoCoord = geoCoordMap[data[i].name];
                        if (geoCoord) {
                            var vr = [];
                            (data[i].value).map(function(v, j) {
                                vr.push({
                                    name: v.name,
                                    value: v.value,
                                    visualMap:false
                                });
                            });
                            var p = chart.convertToPixel({
                                seriesIndex: 0
                            }, geoCoord);
                            sd.push({
                                name: data[i].name,
                                type: 'pie',
                                tooltip: {
                                    formatter: function(params) {
                                        return params.seriesName + "<br/>" + params.name + " : " + params.value+'万人';
                                    }
                                },
                                radius: radius,
                                center: p,
                                data: vr,
                                // zlevel:1,
                                label: {
                                    normal: {
                                        show: false,
                                    },
                                },
                                labelLine: {
                                    normal: {
                                        show: false
                                    }
                                },
                                itemStyle: {
                                    mormal: {
                                        opacity: 0.1
                                    }
                                }
                            });
                        }
                    }
                    return sd;
                };
                /* 指定图表的配置项和数据:pie*/
                var option = {
                    title: {
                        text: nametext,
                        left: 'center',
                        textStyle: {
                            color: 'black'
                        }
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            if (params.value) {
                                return params.name + "<br/>" + '总人口' +
                                    ": " + params.value + '万人';
                            }
                        }
                    },
                    visualMap: {
                        type: 'continuous',
                        show: true,
                        min: 0,
                        max: 200,
                        left: 'left',
                        top: 'bottom',
                        text: ['高    (亿元)', '低    (亿元)'], // 文本，默认为数值文本
                        calculable: true,
                        seriesIndex: [0],
                        inRange: {
                            color:['lightskyblue','yellow','orangered']
                        }
                    },
                    series: [{
                        name: 'chinaMap',
                        type: 'map',
                        mapType: name,
                        roam: true,
                        label: {
                            normal: {
                                show: true,
                                color: 'black',
                                fontSize: 13
                            },
                            emphasis: {
                                show: true
                            }
                        },
                        data: mapdata1 //convertMapDta(typeArr[typeIndex],data)      //mapdata1 //convertMapDta(typeArr[typeIndex],data),
                    }]
                };

                if (option && typeof option === "object") {
                    myChart.setOption(option, true);
                }
                /*pie*/
                addPie(myChart, data);

                myChart.setOption(option, true);

                /*饼图跟着地图移动:pie*/
                myChart.on('georoam', function(params) {
                    resetPie(myChart, params, geoCoordMap, typeIndex);
                });
                myChart.on('datarangeselected', function(params) {
                    resetPie(myChart, params, geoCoordMap, typeIndex);
                });
                window.addEventListener("resize", function() {
                    myChart.resize();
                    resetPie(myChart, 0, geoCoordMap);
                })
                console.log("option"+option)
                myChart.setOption(option);
            })

        }
        else{
            var data = [];
            var mapdata1 = [];
            console.log("地方："+name)
            $.get(mapCode, function(geoJson) {
                var option = null;
                echarts.registerMap(name, geoJson);
                var mapFeatures = echarts.getMap(name).geoJson.features;
                mapFeatures.forEach(function(v) {
                    // 地区名称
                    var name = v.properties.name;
                    // 地区经纬度
                    geoCoordMap[name] = v.properties.cp;
                    //给饼图赋值
                    var s1 = Math.round(Math.random() * 100 + 10);
                    var s2 = Math.round(Math.random() * 100 + 10);
                    // var s3 = Math.round(Math.random() * 100 + 10);
                    data.push({
                        // 需要挨个处理各地区数据（不使用随机产生的数）：另外需要构造的数据是柱图数据
                        "name": name,
                        "value": [
                            {name: "男性",value: s1,},
                            {name: "女性",value: s2,},
                        ]
                    })
                    mapdata1.push({
                        name: name,
                        value: s1 + s2
                    })
                    console.log("数量："+mapdata1.value)
                });
                // 地理坐标图(打印出来方便查看)

                /*变换地图数据（格式）：pie*/
                function convertMapDta(type, data) {
                    var mapData = [];
                    data.forEach(function(v) {
                        v.value.forEach(function(v1) {
                            if (String(v1.name) === String(type)) {
                                // 数据格式：data: [120, 200, 150, 80]
                                mapData.push({
                                    "name": v.name,
                                    "value": v1.value
                                })
                            }
                        })
                    });
                    return mapData;
                }
                /*addPie*/
                function addPie(chart, data) {
                    var op = chart.getOption();
                    var sd = option.series;
                    for (var i = 0; i < data.length; i++) {
                        var randomValue = 15;
                        var radius = randomValue;
                        var geoCoord = geoCoordMap[data[i].name];
                        if (geoCoord) {
                            var vr = [];
                            (data[i].value).map(function(v, j) {
                                vr.push({
                                    name: v.name,
                                    value: v.value,
                                    visualMap:false
                                });
                            });
                            var p = chart.convertToPixel({
                                seriesIndex: 0
                            }, geoCoord);
                            sd.push({
                                name: data[i].name,
                                type: 'pie',
                                tooltip: {
                                    formatter: function(params) {
                                        return params.seriesName + "<br/>" + params.name + " : " + params.value+'万人';
                                    }
                                },
                                radius: radius,
                                center: p,
                                data: vr,
                                // zlevel:1,
                                label: {
                                    normal: {
                                        show: false,
                                    },
                                },
                                labelLine: {
                                    normal: {
                                        show: false
                                    }
                                },
                                itemStyle: {
                                    mormal: {
                                        opacity: 0.1
                                    }
                                }
                            });
                        }
                    }
                    return sd;
                };
                /* 指定图表的配置项和数据:pie*/
                var option = {
                    title: {
                        text: nametext,
                        left: 'center',
                        textStyle: {
                            color: 'black'
                        }
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            if (params.value) {
                                return params.name + "<br/>" + '总人口' +
                                    ": " + params.value + '万人';
                            }
                        }
                    },
                    visualMap: {
                        type: 'continuous',
                        show: true,
                        min: 0,
                        max: 200,
                        left: 'left',
                        top: 'bottom',
                        text: ['高    (亿元)', '低    (亿元)'], // 文本，默认为数值文本
                        calculable: true,
                        seriesIndex: [0],
                        inRange: {
                            color:['lightskyblue','yellow','orangered']
                        }
                    },
                    series: [{
                        name: 'chinaMap',
                        type: 'map',
                        mapType: name,
                        roam: true,
                        label: {
                            normal: {
                                show: true,
                                color: 'black',
                                fontSize: 13
                            },
                            emphasis: {
                                show: true
                            }
                        },
                        data: mapdata1 //convertMapDta(typeArr[typeIndex],data),
                    }]
                };
                if (option && typeof option === "object") {
                    myChart.setOption(option, true);
                }
                /*pie*/
                addPie(myChart, data);

                myChart.setOption(option, true);

                /*饼图跟着地图移动:pie*/
                myChart.on('georoam', function(params) {
                    resetPie(myChart, params, geoCoordMap, typeIndex);
                });
                myChart.on('datarangeselected', function(params) {
                    resetPie(myChart, params, geoCoordMap, typeIndex);
                });
                window.addEventListener("resize", function() {
                    myChart.resize();
                    resetPie(myChart, 0, geoCoordMap);
                })
            })
        }
    }

    //单击切换到省级地图，当mapCode有值,说明可以切换到下级地图
    myChart.on('click', function(params) {
        console.log("点击事件参数：")
        clearTimeout(timeFn);
        //由于单击事件和双击事件冲突，故单击的响应事件延迟250毫秒执行
        timeFn = setTimeout(function() {
            var name = params.name; //地区name
            console.log("点击事件参数："+name)
            var mapCode = provinces[name]; //地区的json数据
            console.log("根据参数，获得mapCode："+mapCode)
            if (!mapCode) {
                alert('无此区域地图显示');
                return;
            }
            //如果获得mapCode,加载地图
            loadMap(mapCode, name);
        }, 250);
    });
    // 绑定双击事件，返回全国地图
    myChart.on('dblclick', function(params) {
        //当双击事件发生时，清除单击事件，仅响应双击事件
        clearTimeout(timeFn);
        //返回全国地图
        loadMap('../datajson/data-1527045631990-r1dZ0IM1X.json', 'china');
    });
    /*resetPie*/
    function resetPie(myChart, params, geoCoordMap, typeIndex) {
        var op = myChart.getOption();
        var ops = op.series;
        ops.forEach(function(v, i) {
            if (i > 0) {
                var geoCoord = geoCoordMap[v.name];
                var p = myChart.convertToPixel({
                    seriesIndex: 0
                }, geoCoord);
                v.center = p;
                if (params != 0 && params.zoom) {
                    v.radius = v.radius * params.zoom;
                }
                if (params != 0 && params.selected) {
                    var rangeFirstNumber = params.selected[0];
                    var rangeSecondNumber = params.selected[1];
                    var pd = v.data[typeIndex].value;
                    if (pd < rangeFirstNumber || pd > rangeSecondNumber) {
                        v.itemStyle.normal.opacity = 0;
                    } else {
                        v.itemStyle.normal.opacity = 1;
                    }
                }
            }
        });
        myChart.setOption(op, true);
    }
</script>
</html>